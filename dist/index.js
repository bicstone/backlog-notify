require('./sourcemap-register.js');(()=>{var e={164:e=>{var t=/<%=([\s\S]+?)%>/g;e.exports=t},320:(e,t,r)=>{e=r.nmd(e);var n=r(164),s=r(637);var o=800,i=16;var a=1/0,u=9007199254740991;var c="[object Arguments]",l="[object Array]",f="[object AsyncFunction]",p="[object Boolean]",m="[object Date]",d="[object DOMException]",y="[object Error]",b="[object Function]",v="[object GeneratorFunction]",g="[object Map]",h="[object Number]",_="[object Null]",j="[object Object]",w="[object Proxy]",T="[object RegExp]",C="[object Set]",O="[object String]",K="[object Symbol]",S="[object Undefined]",R="[object WeakMap]";var x="[object ArrayBuffer]",I="[object DataView]",M="[object Float32Array]",P="[object Float64Array]",A="[object Int8Array]",F="[object Int16Array]",k="[object Int32Array]",E="[object Uint8Array]",G="[object Uint8ClampedArray]",q="[object Uint16Array]",L="[object Uint32Array]";var $=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g;var D=/[\\^$.*+?()[\]{}|]/g;var N=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g;var V=/^\[object .+?Constructor\]$/;var B=/^(?:0|[1-9]\d*)$/;var z=/($^)/;var J=/['\n\r\u2028\u2029\\]/g;var W={};W[M]=W[P]=W[A]=W[F]=W[k]=W[E]=W[G]=W[q]=W[L]=true;W[c]=W[l]=W[x]=W[p]=W[I]=W[m]=W[y]=W[b]=W[g]=W[h]=W[j]=W[T]=W[C]=W[O]=W[R]=false;var Q={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"};var X=typeof global=="object"&&global&&global.Object===Object&&global;var Y=typeof self=="object"&&self&&self.Object===Object&&self;var Z=X||Y||Function("return this")();var ee=true&&t&&!t.nodeType&&t;var te=ee&&"object"=="object"&&e&&!e.nodeType&&e;var re=te&&te.exports===ee;var ne=re&&X.process;var se=function(){try{var e=te&&te.require&&te.require("util").types;if(e){return e}return ne&&ne.binding&&ne.binding("util")}catch(e){}}();var oe=se&&se.isTypedArray;function apply(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function arrayMap(e,t){var r=-1,n=e==null?0:e.length,s=Array(n);while(++r<n){s[r]=t(e[r],r,e)}return s}function baseTimes(e,t){var r=-1,n=Array(e);while(++r<e){n[r]=t(r)}return n}function baseUnary(e){return function(t){return e(t)}}function baseValues(e,t){return arrayMap(t,(function(t){return e[t]}))}function escapeStringChar(e){return"\\"+Q[e]}function getValue(e,t){return e==null?undefined:e[t]}function overArg(e,t){return function(r){return e(t(r))}}var ie=Function.prototype,ae=Object.prototype;var ue=Z["__core-js_shared__"];var ce=ie.toString;var le=ae.hasOwnProperty;var fe=function(){var e=/[^.]+$/.exec(ue&&ue.keys&&ue.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();var pe=ae.toString;var me=ce.call(Object);var de=RegExp("^"+ce.call(le).replace(D,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var ye=re?Z.Buffer:undefined,be=Z.Symbol,ve=overArg(Object.getPrototypeOf,Object),ge=ae.propertyIsEnumerable,he=be?be.toStringTag:undefined;var _e=function(){try{var e=getNative(Object,"defineProperty");e({},"",{});return e}catch(e){}}();var je=ye?ye.isBuffer:undefined,we=overArg(Object.keys,Object),Te=Math.max,Ce=Date.now;var Oe=be?be.prototype:undefined,Ke=Oe?Oe.toString:undefined;function arrayLikeKeys(e,t){var r=Ie(e),n=!r&&xe(e),s=!r&&!n&&Me(e),o=!r&&!n&&!s&&Pe(e),i=r||n||s||o,a=i?baseTimes(e.length,String):[],u=a.length;for(var c in e){if((t||le.call(e,c))&&!(i&&(c=="length"||s&&(c=="offset"||c=="parent")||o&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||isIndex(c,u)))){a.push(c)}}return a}function assignValue(e,t,r){var n=e[t];if(!(le.call(e,t)&&eq(n,r))||r===undefined&&!(t in e)){baseAssignValue(e,t,r)}}function baseAssignValue(e,t,r){if(t=="__proto__"&&_e){_e(e,t,{configurable:true,enumerable:true,value:r,writable:true})}else{e[t]=r}}function baseGetTag(e){if(e==null){return e===undefined?S:_}return he&&he in Object(e)?getRawTag(e):objectToString(e)}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==c}function baseIsNative(e){if(!isObject(e)||isMasked(e)){return false}var t=isFunction(e)?de:V;return t.test(toSource(e))}function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!W[baseGetTag(e)]}function baseKeys(e){if(!isPrototype(e)){return we(e)}var t=[];for(var r in Object(e)){if(le.call(e,r)&&r!="constructor"){t.push(r)}}return t}function baseKeysIn(e){if(!isObject(e)){return nativeKeysIn(e)}var t=isPrototype(e),r=[];for(var n in e){if(!(n=="constructor"&&(t||!le.call(e,n)))){r.push(n)}}return r}function baseRest(e,t){return Re(overRest(e,t,identity),e+"")}var Se=!_e?identity:function(e,t){return _e(e,"toString",{configurable:true,enumerable:false,value:constant(t),writable:true})};function baseToString(e){if(typeof e=="string"){return e}if(Ie(e)){return arrayMap(e,baseToString)+""}if(isSymbol(e)){return Ke?Ke.call(e):""}var t=e+"";return t=="0"&&1/e==-a?"-0":t}function copyObject(e,t,r,n){var s=!r;r||(r={});var o=-1,i=t.length;while(++o<i){var a=t[o];var u=n?n(r[a],e[a],a,r,e):undefined;if(u===undefined){u=e[a]}if(s){baseAssignValue(r,a,u)}else{assignValue(r,a,u)}}return r}function createAssigner(e){return baseRest((function(t,r){var n=-1,s=r.length,o=s>1?r[s-1]:undefined,i=s>2?r[2]:undefined;o=e.length>3&&typeof o=="function"?(s--,o):undefined;if(i&&isIterateeCall(r[0],r[1],i)){o=s<3?undefined:o;s=1}t=Object(t);while(++n<s){var a=r[n];if(a){e(t,a,n,o)}}return t}))}function customDefaultsAssignIn(e,t,r,n){if(e===undefined||eq(e,ae[r])&&!le.call(n,r)){return t}return e}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:undefined}function getRawTag(e){var t=le.call(e,he),r=e[he];try{e[he]=undefined;var n=true}catch(e){}var s=pe.call(e);if(n){if(t){e[he]=r}else{delete e[he]}}return s}function isIndex(e,t){var r=typeof e;t=t==null?u:t;return!!t&&(r=="number"||r!="symbol"&&B.test(e))&&(e>-1&&e%1==0&&e<t)}function isIterateeCall(e,t,r){if(!isObject(r)){return false}var n=typeof t;if(n=="number"?isArrayLike(r)&&isIndex(t,r.length):n=="string"&&t in r){return eq(r[t],e)}return false}function isMasked(e){return!!fe&&fe in e}function isPrototype(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||ae;return e===r}function nativeKeysIn(e){var t=[];if(e!=null){for(var r in Object(e)){t.push(r)}}return t}function objectToString(e){return pe.call(e)}function overRest(e,t,r){t=Te(t===undefined?e.length-1:t,0);return function(){var n=arguments,s=-1,o=Te(n.length-t,0),i=Array(o);while(++s<o){i[s]=n[t+s]}s=-1;var a=Array(t+1);while(++s<t){a[s]=n[s]}a[t]=r(i);return apply(e,this,a)}}var Re=shortOut(Se);function shortOut(e){var t=0,r=0;return function(){var n=Ce(),s=i-(n-r);r=n;if(s>0){if(++t>=o){return arguments[0]}}else{t=0}return e.apply(undefined,arguments)}}function toSource(e){if(e!=null){try{return ce.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eq(e,t){return e===t||e!==e&&t!==t}var xe=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&le.call(e,"callee")&&!ge.call(e,"callee")};var Ie=Array.isArray;function isArrayLike(e){return e!=null&&isLength(e.length)&&!isFunction(e)}var Me=je||stubFalse;function isError(e){if(!isObjectLike(e)){return false}var t=baseGetTag(e);return t==y||t==d||typeof e.message=="string"&&typeof e.name=="string"&&!isPlainObject(e)}function isFunction(e){if(!isObject(e)){return false}var t=baseGetTag(e);return t==b||t==v||t==f||t==w}function isLength(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=u}function isObject(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function isObjectLike(e){return e!=null&&typeof e=="object"}function isPlainObject(e){if(!isObjectLike(e)||baseGetTag(e)!=j){return false}var t=ve(e);if(t===null){return true}var r=le.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&ce.call(r)==me}function isSymbol(e){return typeof e=="symbol"||isObjectLike(e)&&baseGetTag(e)==K}var Pe=oe?baseUnary(oe):baseIsTypedArray;function toString(e){return e==null?"":baseToString(e)}var Ae=createAssigner((function(e,t,r,n){copyObject(t,keysIn(t),e,n)}));function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function keysIn(e){return isArrayLike(e)?arrayLikeKeys(e,true):baseKeysIn(e)}function template(e,t,r){var o=s.imports._.templateSettings||s;if(r&&isIterateeCall(e,t,r)){t=undefined}e=toString(e);t=Ae({},t,o,customDefaultsAssignIn);var i=Ae({},t.imports,o.imports,customDefaultsAssignIn),a=keys(i),u=baseValues(i,a);var c,l,f=0,p=t.interpolate||z,m="__p += '";var d=RegExp((t.escape||z).source+"|"+p.source+"|"+(p===n?N:z).source+"|"+(t.evaluate||z).source+"|$","g");var y=le.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";e.replace(d,(function(t,r,n,s,o,i){n||(n=s);m+=e.slice(f,i).replace(J,escapeStringChar);if(r){c=true;m+="' +\n__e("+r+") +\n'"}if(o){l=true;m+="';\n"+o+";\n__p += '"}if(n){m+="' +\n((__t = ("+n+")) == null ? '' : __t) +\n'"}f=i+t.length;return t}));m+="';\n";var b=le.call(t,"variable")&&t.variable;if(!b){m="with (obj) {\n"+m+"\n}\n"}m=(l?m.replace($,""):m).replace(U,"$1").replace(H,"$1;");m="function("+(b||"obj")+") {\n"+(b?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(c?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n":";\n")+m+"return __p\n}";var v=Fe((function(){return Function(a,y+"return "+m).apply(undefined,u)}));v.source=m;if(isError(v)){throw v}return v}var Fe=baseRest((function(e,t){try{return apply(e,undefined,t)}catch(e){return isError(e)?e:new Error(e)}}));function constant(e){return function(){return e}}function identity(e){return e}function stubFalse(){return false}e.exports=template},637:(e,t,r)=>{var n=r(164);var s=1/0;var o="[object Null]",i="[object Symbol]",a="[object Undefined]";var u=/[&<>"']/g,c=RegExp(u.source);var l=/<%-([\s\S]+?)%>/g,f=/<%([\s\S]+?)%>/g;var p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};var m=typeof global=="object"&&global&&global.Object===Object&&global;var d=typeof self=="object"&&self&&self.Object===Object&&self;var y=m||d||Function("return this")();function arrayMap(e,t){var r=-1,n=e==null?0:e.length,s=Array(n);while(++r<n){s[r]=t(e[r],r,e)}return s}function basePropertyOf(e){return function(t){return e==null?undefined:e[t]}}var b=basePropertyOf(p);var v=Object.prototype;var g=v.hasOwnProperty;var h=v.toString;var _=y.Symbol,j=_?_.toStringTag:undefined;var w=_?_.prototype:undefined,T=w?w.toString:undefined;var C={escape:l,evaluate:f,interpolate:n,variable:"",imports:{_:{escape:escape}}};function baseGetTag(e){if(e==null){return e===undefined?a:o}return j&&j in Object(e)?getRawTag(e):objectToString(e)}function baseToString(e){if(typeof e=="string"){return e}if(O(e)){return arrayMap(e,baseToString)+""}if(isSymbol(e)){return T?T.call(e):""}var t=e+"";return t=="0"&&1/e==-s?"-0":t}function getRawTag(e){var t=g.call(e,j),r=e[j];try{e[j]=undefined;var n=true}catch(e){}var s=h.call(e);if(n){if(t){e[j]=r}else{delete e[j]}}return s}function objectToString(e){return h.call(e)}var O=Array.isArray;function isObjectLike(e){return e!=null&&typeof e=="object"}function isSymbol(e){return typeof e=="symbol"||isObjectLike(e)&&baseGetTag(e)==i}function toString(e){return e==null?"":baseToString(e)}function escape(e){e=toString(e);return e&&c.test(e)?e.replace(u,b):e}e.exports=C},92:e=>{"use strict";var t=Object.defineProperty;var r=Object.getOwnPropertyDescriptor;var n=Object.getOwnPropertyNames;var s=Object.prototype.hasOwnProperty;var __export=(e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:true})};var __copyProps=(e,o,i,a)=>{if(o&&typeof o==="object"||typeof o==="function"){for(let u of n(o))if(!s.call(e,u)&&u!==i)t(e,u,{get:()=>o[u],enumerable:!(a=r(o,u))||a.enumerable})}return e};var __toCommonJS=e=>__copyProps(t({},"__esModule",{value:true}),e);var o={};__export(o,{Result:()=>a,prototype:()=>i});e.exports=__toCommonJS(o);function getOrThrow(){if(this.isSuccess)return this.value;throw this.error}function toUnion(){if(this.isSuccess)return this.value;return this.error}function ifSuccess(e){if(this.isFailure)return void 0;return e(this.value)}function ifFailure(e){if(this.isSuccess)return void 0;return e(this.error)}function match(e,t){if(this.isSuccess)return e(this.value);return t(this.error)}function map(e){if(this.isFailure)return this;return a.success(e(this.value))}function mapError(e){if(this.isSuccess)return this;return a.failure(e(this.error))}function flatMap(e){if(this.isFailure)return this;return e(this.value)}function flatMapAsync(e){if(this.isFailure)return Promise.resolve(this);return e(this.value)}function flatten(){if(this.isFailure)return this;return this.value}function assertErrorInstanceOf(e){if(this.isSuccess)return this;if(this.error instanceof e)return this;throw new TypeError(`Assertion failed: Expected error to be an instance of ${e.name}.`)}var i={getOrThrow:getOrThrow,toUnion:toUnion,ifSuccess:ifSuccess,ifFailure:ifFailure,match:match,map:map,mapError:mapError,flatMap:flatMap,flatMapAsync:flatMapAsync,flatten:flatten,assertErrorInstanceOf:assertErrorInstanceOf};var a;(e=>{function success(e){return withPrototype({value:e,isSuccess:true,isFailure:false},i)}e.success=success;function failure(e){return withPrototype({error:e,isSuccess:false,isFailure:true},i)}e.failure=failure;function tryCatch(e){try{return success(e())}catch(e){return failure(e)}}e.tryCatch=tryCatch;async function fromPromise(e){try{return success(await e)}catch(e){return failure(e)}}e.fromPromise=fromPromise;function fromNullish(e){return e!=null?success(e):failure(e)}e.fromNullish=fromNullish;function all(e){const t=[];for(const r of e){if(r.isFailure)return r;t.push(r.value)}return success(t)}e.all=all})(a||(a={}));function withPrototype(e,t){return Object.assign(Object.create(t),e)}0&&0},611:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){if(n===undefined)n=r;var s=Object.getOwnPropertyDescriptor(t,r);if(!s||("get"in s?!t.__esModule:s.writable||s.configurable)){s={enumerable:true,get:function(){return t[r]}}}Object.defineProperty(e,n,s)}:function(e,t,r,n){if(n===undefined)n=r;e[n]=t[r]});var s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:true,value:t})}:function(e,t){e["default"]=t});var o=this&&this.__importStar||function(){var ownKeys=function(e){ownKeys=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))t[t.length]=r;return t};return ownKeys(e)};return function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=ownKeys(e),o=0;o<r.length;o++)if(r[o]!=="default")n(t,e,r[o]);s(t,e);return t}}();Object.defineProperty(t,"__esModule",{value:true});t.info=info;t.startGroup=startGroup;t.endGroup=endGroup;t.setFailed=setFailed;const i=o(r(161));const a="::";var u;(function(e){e[e["success"]=0]="success";e[e["failure"]=1]="failure"})(u||(u={}));function info(e){process.stdout.write(e+i.EOL)}function startGroup(e){process.stdout.write(a+"group"+a+e+i.EOL)}function endGroup(){process.stdout.write(a+"endgroup"+a+i.EOL)}function setFailed(e){const t=e instanceof Error?e.toString():e;process.exitCode=u.failure;process.stdout.write(a+"error"+a+t+i.EOL)}},353:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.main=void 0;const n=r(611);const s=r(48);const o=r(347);const i=r(589);const a=r(579);const runAction=async()=>{(0,n.startGroup)("設定を読み込み中");const{projectKey:e,apiHost:t,apiKey:r,githubEventPath:u,fixKeywords:c,closeKeywords:l,pushCommentTemplate:f,prOpenedCommentTemplate:p,prReopenedCommentTemplate:m,prReadyForReviewCommentTemplate:d,prClosedCommentTemplate:y,prMergedCommentTemplate:b,commitMessageRegTemplate:v,prTitleRegTemplate:g,fixStatusId:h,closeStatusId:_}=(0,o.getConfigs)();(0,n.endGroup)();(0,n.startGroup)("イベントを読み込み中");const{event:j}=(0,s.fetchEvent)({path:u});(0,n.endGroup)();if(j&&"commits"in j&&j.commits.length>0){return await(0,a.push)({event:j,projectKey:e,apiHost:t,apiKey:r,fixKeywords:c,closeKeywords:l,pushCommentTemplate:f,commitMessageRegTemplate:v,fixStatusId:h,closeStatusId:_})}if(j&&"pull_request"in j&&"number"in j){return await(0,i.pr)({event:j,projectKey:e,apiHost:t,apiKey:r,fixKeywords:c,closeKeywords:l,fixStatusId:h,closeStatusId:_,prOpenedCommentTemplate:p,prReopenedCommentTemplate:m,prReadyForReviewCommentTemplate:d,prClosedCommentTemplate:y,prMergedCommentTemplate:b,prTitleRegTemplate:g})}return"予期しないイベントでした。"};const main=async()=>{try{const e=await runAction();(0,n.info)(e)}catch(e){if(e instanceof Error){(0,n.setFailed)(e)}else{(0,n.setFailed)(String(e))}}(0,n.endGroup)()};t.main=main;void(0,t.main)()},48:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.fetchEvent=void 0;const n=r(24);const fetchEvent=({path:e})=>{const t=(0,n.readFileSync)(e,"utf8");return{event:JSON.parse(t)}};t.fetchEvent=fetchEvent},347:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.getConfigs=t.defaultConfigs=void 0;t.getMultilineInput=getMultilineInput;t.defaultConfigs={fixKeywords:["#fix","#fixes","#fixed"],closeKeywords:["#close","#closes","#closed"],pushCommentTemplate:"<%= commits[0].author.name %>さんが[<%= ref.name %>](<%= ref.url %>)にプッシュしました"+"\n"+"<% commits.forEach(commit=>{ %>"+"\n"+"+ [<%= commit.comment %>](<%= commit.url %>) (<% print(commit.id.slice(0, 7)) %>)"+"<% }); %>",prOpenedCommentTemplate:"<%= sender.login %>さんがプルリクエストを作成しました"+"\n\n"+"+ [<%= title %>](<%= pr.html_url %>) (#<%= pr.number %>)",prReopenedCommentTemplate:"<%= sender.login %>さんがプルリクエストを作成しました"+"\n\n"+"+ [<%= title %>](<%= pr.html_url %>) (#<%= pr.number %>)",prReadyForReviewCommentTemplate:"<%= sender.login %>さんがプルリクエストを作成しました"+"\n\n"+"+ [<%= title %>](<%= pr.html_url %>) (#<%= pr.number %>)",prClosedCommentTemplate:"<%= sender.login %>さんがプルリクエストをクローズしました"+"\n\n"+"+ [<%= title %>](<%= pr.html_url %>) (#<%= pr.number %>)",prMergedCommentTemplate:"<%= sender.login %>さんがプルリクエストをマージしました"+"\n\n"+"+ [<%= title %>](<%= pr.html_url %>) (#<%= pr.number %>)",commitMessageRegTemplate:"^"+"(<%= projectKey %>\\-\\d+)\\s?"+"(.*?)?\\s?"+"(<% print(fixKeywords.join('|')) %>|<% print(closeKeywords.join('|')) %>)?"+"$",prTitleRegTemplate:"^"+"(<%= projectKey %>\\-\\d+)\\s?"+"(.*?)?\\s?"+"(<% print(fixKeywords.join('|')) %>|<% print(closeKeywords.join('|')) %>)?"+"$",fixStatusId:"3",closeStatusId:"4"};const getConfigs=()=>({projectKey:getConfig("project_key",{required:true}),apiHost:getConfig("api_host",{required:true}),apiKey:getConfig("api_key",{required:true}),githubEventPath:getConfig("github_event_path",{required:true}),fixKeywords:getConfig("fix_keywords")?getMultilineInput("fix_keywords"):t.defaultConfigs.fixKeywords,closeKeywords:getConfig("close_keywords")?getMultilineInput("close_keywords"):t.defaultConfigs.closeKeywords,pushCommentTemplate:getConfig("push_comment_template")||t.defaultConfigs.pushCommentTemplate,prOpenedCommentTemplate:getConfig("pr_opened_comment_template")||t.defaultConfigs.prOpenedCommentTemplate,prReopenedCommentTemplate:getConfig("pr_reopened_comment_template")||t.defaultConfigs.prReopenedCommentTemplate,prReadyForReviewCommentTemplate:getConfig("pr_ready_for_review_comment_template")||t.defaultConfigs.prReadyForReviewCommentTemplate,prClosedCommentTemplate:getConfig("pr_closed_comment_template")||t.defaultConfigs.prClosedCommentTemplate,prMergedCommentTemplate:getConfig("pr_merged_comment_template")||t.defaultConfigs.prMergedCommentTemplate,commitMessageRegTemplate:getConfig("commit_message_reg_template")||t.defaultConfigs.commitMessageRegTemplate,prTitleRegTemplate:getConfig("pr_title_reg_template")||t.defaultConfigs.prTitleRegTemplate,fixStatusId:getConfig("fix_status_id")||t.defaultConfigs.fixStatusId,closeStatusId:getConfig("close_status_id")||t.defaultConfigs.closeStatusId});t.getConfigs=getConfigs;const getConfig=(e,t={})=>{const r=e.toUpperCase();const n=process.env[`INPUT_${r}`];const s=process.env[r];const o=n||s||"";if(t.required&&!o){throw new Error(`Input required and not supplied: ${e}`)}return o.trim()};function getMultilineInput(e,t={}){const r=getConfig(e,t).split("\n").filter((e=>e!==""));return r.map((e=>e.trim()))}},589:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.pr=void 0;const n=r(611);const s=r(792);const o=r(189);const pr=async({event:e,projectKey:t,fixKeywords:r,closeKeywords:i,fixStatusId:a,closeStatusId:u,apiHost:c,apiKey:l,prOpenedCommentTemplate:f,prReopenedCommentTemplate:p,prReadyForReviewCommentTemplate:m,prClosedCommentTemplate:d,prMergedCommentTemplate:y,prTitleRegTemplate:b})=>{(0,n.startGroup)("プルリクエストを取得中");const{parsedPullRequest:v}=(0,s.parsePullRequest)({event:e,projectKey:t,fixKeywords:r,closeKeywords:i,prTitleRegTemplate:b});if(!v){return"課題キーのついたプルリクエストが見つかりませんでした。"}(0,n.endGroup)();(0,n.startGroup)("コメント送信中");const g=await(0,o.postComments)({parsedPullRequest:v,fixStatusId:a,closeStatusId:u,prOpenedCommentTemplate:f,prReopenedCommentTemplate:p,prReadyForReviewCommentTemplate:m,prClosedCommentTemplate:d,prMergedCommentTemplate:y,apiHost:c,apiKey:l});if(g.isFailure){return g.error}(0,n.startGroup)(`${v.issueKey}:`);(0,n.info)(v.title);if(v.isFix){(0,n.info)(`${v.issueKey}を処理済みにしました。`)}if(v.isClose){(0,n.info)(`${v.issueKey}を完了にしました。`)}(0,n.endGroup)();(0,n.endGroup)();return"正常に送信しました。"};t.pr=pr},792:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.parsePullRequest=void 0;const s=n(r(320));const parsePullRequest=({event:e,projectKey:t,fixKeywords:r,closeKeywords:n,prTitleRegTemplate:o})=>{const i=RegExp((0,s.default)(o)({projectKey:t,fixKeywords:r,closeKeywords:n}),"s");const a=e.pull_request.title.match(i);const[,u=null,c="",l=""]=a??[];if(!a||!u){return{parsedPullRequest:null}}return{parsedPullRequest:{pr:e.pull_request,action:e.action,sender:e.sender,issueKey:u,title:c,keywords:l,isFix:r.includes(l),isClose:n.includes(l)}}};t.parsePullRequest=parsePullRequest},189:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.postComments=void 0;const s=r(92);const o=r(136);const i=n(r(320));const a=(0,i.default)("https://<%=apiHost%>/api/v2/issues/<%=issueKey%>?apiKey=<%=apiKey%>");const postComments=async({parsedPullRequest:e,fixStatusId:t,closeStatusId:r,prOpenedCommentTemplate:n,prReopenedCommentTemplate:u,prReadyForReviewCommentTemplate:c,prClosedCommentTemplate:l,prMergedCommentTemplate:f,apiHost:p,apiKey:m})=>{const{issueKey:d,isFix:y,isClose:b,action:v,pr:g}=e;const h=a({apiHost:p,apiKey:m,issueKey:d});const _=(()=>{switch(v){case"opened":return(0,i.default)(n)(e);case"reopened":return(0,i.default)(u)(e);case"ready_for_review":return(0,i.default)(c)(e);case"closed":if(g.merged){return(0,i.default)(f)(e)}else{return(0,i.default)(l)(e)}default:return undefined}})();if(!_){return s.Result.failure("予期しないイベントでした。")}const{draft:j}=g;if(j){return s.Result.failure("プルリクエストが下書きでした。")}const w=(()=>{if(g.merged&&y)return{statusId:t};if(g.merged&&b)return{statusId:r};else return undefined})();const T={comment:_,...w};const C={method:"PATCH",body:new o.URLSearchParams(T)};const O=await fetch(h,C);if(!O.ok){throw new Error(O.statusText)}return s.Result.success(O.statusText)};t.postComments=postComments},579:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});t.push=void 0;const n=r(611);const s=r(144);const o=r(719);const i=r(243);const push=async({event:e,projectKey:t,fixKeywords:r,closeKeywords:a,commitMessageRegTemplate:u,pushCommentTemplate:c,fixStatusId:l,closeStatusId:f,apiHost:p,apiKey:m})=>{(0,n.startGroup)("コミット取得中");const{parsedCommits:d}=(0,s.parseCommits)({commits:e.commits,projectKey:t,fixKeywords:r,closeKeywords:a,commitMessageRegTemplate:u});if(!d){return"課題キーのついたコミットが1件も見つかりませんでした。"}(0,n.endGroup)();(0,n.startGroup)("Push先の確認中");const y=(0,o.parseRef)(e.ref,e.repository.html_url);if(!y){return"Git referenceの解析に失敗しました。"}(0,n.endGroup)();(0,n.startGroup)("コメント送信中");await(0,i.postComments)({parsedCommits:d,parsedRef:y,pushCommentTemplate:c,fixStatusId:l,closeStatusId:f,apiHost:p,apiKey:m}).then((e=>{e.forEach((({commits:e,issueKey:t,isFix:r,isClose:s})=>{(0,n.startGroup)(`${e[0].issueKey}:`);e.forEach((({message:e})=>{(0,n.info)(e)}));if(r){(0,n.info)(`${t}を処理済みにしました。`)}if(s){(0,n.info)(`${t}を完了にしました。`)}(0,n.endGroup)()}))}));(0,n.endGroup)();return"正常に送信しました。"};t.push=push},144:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.parseCommits=void 0;const s=n(r(320));const parseCommits=({commits:e,projectKey:t,fixKeywords:r,closeKeywords:n,commitMessageRegTemplate:o})=>{const i={};const a=RegExp((0,s.default)(o)({projectKey:t,fixKeywords:r,closeKeywords:n}),"s");e.forEach((e=>{const{parsedCommit:t}=parseCommit({commit:e,fixKeywords:r,closeKeywords:n,commitMessageReg:a});if(!t?.issueKey)return;if(i[t.issueKey]){i[t.issueKey].push(t)}else{i[t.issueKey]=[t]}}));const u=Object.keys(i).length;if(u===0){return{parsedCommits:null}}return{parsedCommits:i}};t.parseCommits=parseCommits;const parseCommit=({commit:e,fixKeywords:t,closeKeywords:r,commitMessageReg:n})=>{const s=e.message.match(n);if(!s){return{parsedCommit:null}}const[,o=null,i="",a=""]=s;return{parsedCommit:{...e,issueKey:o,comment:i,keywords:a,isFix:t.includes(a),isClose:r.includes(a)}}}},719:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.parseRef=void 0;const s=n(r(320));const o=/refs\/[a-z]*\/(.*)/;const i=(0,s.default)("<%= repositoryHtmlUrl %>/tree/<%= name %>");const parseRef=(e,t)=>{const r=o.exec(e)?.[1];if(!r)return;const n=i({repositoryHtmlUrl:t,name:r});return{name:r,url:n}};t.parseRef=parseRef},243:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:true});t.postComments=void 0;const s=n(r(320));const o=(0,s.default)("https://<%=apiHost%>/api/v2/issues/<%=issueKey%>?apiKey=<%=apiKey%>");const postComments=async({parsedCommits:e,parsedRef:t,...r})=>{const n=[];for(const[s,o]of Object.entries(e)){n.push(createPatchCommentRequest({commits:o,issueKey:s,ref:t,...r}))}return await Promise.all(n)};t.postComments=postComments;const createPatchCommentRequest=async({commits:e,ref:t,issueKey:r,fixStatusId:n,closeStatusId:i,pushCommentTemplate:a,apiHost:u,apiKey:c})=>{const l=o({apiHost:u,apiKey:c,issueKey:r});const f=(0,s.default)(a)({commits:e,ref:t});const p=e.map((e=>e.isFix)).includes(true);const m=e.map((e=>e.isClose)).includes(true);const d=(()=>{if(p)return{statusId:n};if(m)return{statusId:i};else return undefined})();const y={comment:f,...d};const b={method:"PATCH",body:new URLSearchParams(y)};const v=await fetch(l,b);if(!v.ok){throw new Error(v.statusText)}return{commits:e,issueKey:r,isFix:p,isClose:m}}},24:e=>{"use strict";e.exports=require("node:fs")},161:e=>{"use strict";e.exports=require("node:os")},136:e=>{"use strict";e.exports=require("node:url")}};var t={};function __nccwpck_require__(r){var n=t[r];if(n!==undefined){return n.exports}var s=t[r]={id:r,loaded:false,exports:{}};var o=true;try{e[r].call(s.exports,s,s.exports,__nccwpck_require__);o=false}finally{if(o)delete t[r]}s.loaded=true;return s.exports}(()=>{__nccwpck_require__.nmd=e=>{e.paths=[];if(!e.children)e.children=[];return e}})();if(typeof __nccwpck_require__!=="undefined")__nccwpck_require__.ab=__dirname+"/";var r=__nccwpck_require__(353);module.exports=r})();
//# sourceMappingURL=index.js.map